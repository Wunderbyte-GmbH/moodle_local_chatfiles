{"version":3,"sources":["../src/main.js"],"names":["define","$","init","upload","bind","uploadFile","fileData","drawer","prop","formData","FormData","append","username","text","ajax","url","M","cfg","wwwroot","sesskey","dataType","cache","contentType","processData","data","type","success","response","textarea","obj","parseJSON","error","val","file","filename","click"],"mappings":"AAAAA,OAAM,wBACF,CAAC,QAAD,CADE,CAEF,SAASC,CAAT,CAAY,CAEZ,MAAO,CACHC,IAAI,CAAE,cAASC,CAAT,CAAiB,CACnBA,CAAM,CAAGF,CAAC,CAACE,CAAD,CAAV,CACAA,CAAM,CAACC,IAAP,CAAY,OAAZ,CAAqB,KAAKC,UAAL,CAAgBF,CAAhB,CAArB,CACH,CAJE,CAMHE,UAAU,CAAE,qBAAW,IACfC,CAAAA,CADe,CAEfC,CAAM,CAAG,CAFM,CAGnB,GAAIN,CAAC,CAAC,wBAAD,CAAD,CAA4BO,IAA5B,CAAiC,OAAjC,EAA0C,CAA1C,CAAJ,CAAkD,CAC9CF,CAAQ,CAAGL,CAAC,CAAC,wBAAD,CAAD,CAA4BO,IAA5B,CAAiC,OAAjC,EAA0C,CAA1C,CAAX,CACAD,CAAM,CAAG,CACZ,CAHD,IAGO,CACHD,CAAQ,CAAGL,CAAC,CAAC,iBAAD,CAAD,CAAqBO,IAArB,CAA0B,OAA1B,EAAmC,CAAnC,CAAX,CACAD,CAAM,CAAG,CACZ,CACD,GAAI,CAACD,CAAL,CAAe,CACZ,MACF,CACD,GAAIG,CAAAA,CAAQ,CAAG,GAAIC,CAAAA,QAAnB,CACAD,CAAQ,CAACE,MAAT,CAAgB,MAAhB,CAAwBL,CAAxB,EACA,GAAIM,CAAAA,CAAQ,CAAGX,CAAC,CAAC,2FAAD,CAAD,CAA2FY,IAA3F,EAAf,CACAJ,CAAQ,CAACE,MAAT,CAAgB,MAAhB,CAAwBC,CAAxB,EACAH,CAAQ,CAACE,MAAT,CAAgB,QAAhB,CAA0BJ,CAA1B,EACAN,CAAC,CAACa,IAAF,CAAO,CACHC,GAAG,CAAEC,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,oCAAhB,CAAuDF,CAAC,CAACC,GAAF,CAAME,OAD/D,CAEHC,QAAQ,CAAE,MAFP,CAGHC,KAAK,GAHF,CAIHC,WAAW,GAJR,CAKHC,WAAW,GALR,CAMHC,IAAI,CAAEf,CANH,CAOHgB,IAAI,CAAE,MAPH,CAQHC,OAAO,CAAE,iBAASC,CAAT,CAAmB,IACpBC,CAAAA,CADoB,CAEpBC,CAAG,CAAG5B,CAAC,CAAC6B,SAAF,CAAaH,CAAb,CAFc,CAGxB,GAAkB,CAAd,EAAAE,CAAG,CAACtB,MAAR,CAAqB,CACjBqB,CAAQ,CAAG3B,CAAC,CAAC,iDAAD,CACf,CAFD,IAEO,IAAkB,CAAd,EAAA4B,CAAG,CAACtB,MAAR,CAAqB,CACxBqB,CAAQ,CAAG3B,CAAC,CAAC,0CAAD,CACf,CAED,GAAI4B,CAAG,CAACE,KAAR,CAAe,CACX9B,CAAC,CAAC,WAAD,CAAD,CAAe+B,GAAf,CAAmB,EAAnB,EACA,MACH,CACD,GAAIC,CAAAA,CAAI,CAAG,8DAA2DJ,CAAG,CAACd,GAA/D,CACV,sDADU,CAC4Cc,CAAG,CAACK,QADhD,CAC2D,UADtE,CAEAN,CAAQ,CAACI,GAAT,CAAaC,CAAb,EACA,GAAkB,CAAd,EAAAJ,CAAG,CAACtB,MAAR,CAAqB,CACjBN,CAAC,CAAC,wBAAD,CAAD,CAA4B+B,GAA5B,CAAgC,EAAhC,EACA/B,CAAC,CAAC,gCAAD,CAAD,CAAkCkC,KAAlC,EACH,CAHD,IAGO,IAAkB,CAAd,EAAAN,CAAG,CAACtB,MAAR,CAAqB,CACxBN,CAAC,CAAC,iBAAD,CAAD,CAAqB+B,GAArB,CAAyB,EAAzB,EACA/B,CAAC,CAAC,sCAAD,CAAD,CAAwCkC,KAAxC,EACH,CACJ,CA/BE,CAAP,CAiCD,CAzDA,CA2DV,CA/DK,CAAN","sourcesContent":["define(\r\n    ['jquery'],\r\n    function($) {\r\n\r\n    return {\r\n        init: function(upload) {\r\n            upload = $(upload);\r\n            upload.bind('click', this.uploadFile(upload));\r\n        },\r\n\r\n        uploadFile: function() {\r\n            let fileData;\r\n            let drawer = 0;\r\n            if ($('[id^=drawer] #chatfile').prop('files')[0]) {\r\n                fileData = $('[id^=drawer] #chatfile').prop('files')[0];\r\n                drawer = 1;\r\n            } else {\r\n                fileData = $('#page #chatfile').prop('files')[0];\r\n                drawer = 2;\r\n            }\r\n            if (!fileData) {\r\n               return;\r\n            }\r\n            var formData = new FormData();\r\n            formData.append('file', fileData);\r\n            var username = $('[data-region=\"view-conversation\"] [data-region=\"header-content\"] strong.text-truncate').text();\r\n            formData.append('name', username);\r\n            formData.append('drawer', drawer);\r\n            $.ajax({\r\n                url: M.cfg.wwwroot + '/local/chatfiles/ajax.php?sesskey=' + M.cfg.sesskey,\r\n                dataType: 'text',\r\n                cache: false,\r\n                contentType: false,\r\n                processData: false,\r\n                data: formData,\r\n                type: 'post',\r\n                success: function(response) {\r\n                    var textarea;\r\n                    var obj = $.parseJSON( response );\r\n                    if (obj.drawer == 1) {\r\n                        textarea = $('[id^=drawer] [data-region=\"send-message-txt\"]');\r\n                    } else if (obj.drawer == 2) {\r\n                        textarea = $('#page [data-region=\"send-message-txt\"]');\r\n                    }\r\n\r\n                    if (obj.error) {\r\n                        $('#chatfile').val(\"\");\r\n                        return;\r\n                    }\r\n                    var file = '<p class=\"text-success font-italic\"><a class=\"\" href=\"' + obj.url +\r\n                     '\"><i class=\"fa fa-file-o fa-2x pr-2 d-block\"></i>' + obj.filename + '</a></p>';\r\n                    textarea.val(file);\r\n                    if (obj.drawer == 1) {\r\n                        $('[id^=drawer] #chatfile').val(\"\");\r\n                        $('[data-action=\"send-message\"]').click();\r\n                    } else if (obj.drawer == 2) {\r\n                        $('#page #chatfile').val(\"\");\r\n                        $('#page [data-action=\"send-message\"]').click();\r\n                    }\r\n                }\r\n             });\r\n          },\r\n    };\r\n});\r\n"],"file":"main.min.js"}
{"version":3,"sources":["../src/main.js"],"names":["define","$","init","upload","bind","uploadFile","file_data","drawer","prop","form_data","FormData","append","username","text","ajax","url","M","cfg","wwwroot","sesskey","dataType","cache","contentType","processData","data","type","success","response","textarea","obj","parseJSON","error","alert","val","file","filename","click"],"mappings":"AAAAA,OAAM,wBACF,CAAC,QAAD,CADE,CAEF,SAASC,CAAT,CAAY,CAEZ,MAAO,CACHC,IAAI,CAAE,cAASC,CAAT,CAAiB,CACnBA,CAAM,CAAGF,CAAC,CAACE,CAAD,CAAV,CACAA,CAAM,CAACC,IAAP,CAAY,OAAZ,CAAqB,KAAKC,UAAL,CAAgBF,CAAhB,CAArB,CACH,CAJE,CAMHE,UAAU,CAAE,qBAAc,IAClBC,CAAAA,CADkB,CAElBC,CAAM,CAAG,CAFS,CAGtB,GAAIN,CAAC,CAAC,wBAAD,CAAD,CAA4BO,IAA5B,CAAiC,OAAjC,EAA0C,CAA1C,CAAJ,CAAkD,CAC9CF,CAAS,CAAGL,CAAC,CAAC,wBAAD,CAAD,CAA4BO,IAA5B,CAAiC,OAAjC,EAA0C,CAA1C,CAAZ,CACAD,CAAM,CAAG,CACZ,CAHD,IAGO,CACHD,CAAS,CAAGL,CAAC,CAAC,iBAAD,CAAD,CAAqBO,IAArB,CAA0B,OAA1B,EAAmC,CAAnC,CAAZ,CACAD,CAAM,CAAG,CACZ,CAED,GAAI,CAACD,CAAL,CAAgB,CAAE,MAAS,CAC3B,GAAIG,CAAAA,CAAS,CAAG,GAAIC,CAAAA,QAApB,CACAD,CAAS,CAACE,MAAV,CAAiB,MAAjB,CAAyBL,CAAzB,EACA,GAAIM,CAAAA,CAAQ,CAAGX,CAAC,CAAC,2FAAD,CAAD,CAA2FY,IAA3F,EAAf,CACAJ,CAAS,CAACE,MAAV,CAAiB,MAAjB,CAAyBC,CAAzB,EACAH,CAAS,CAACE,MAAV,CAAiB,QAAjB,CAA2BJ,CAA3B,EACAN,CAAC,CAACa,IAAF,CAAO,CACHC,GAAG,CAAEC,CAAC,CAACC,GAAF,CAAMC,OAAN,CAAgB,oCAAhB,CAAuDF,CAAC,CAACC,GAAF,CAAME,OAD/D,CAEHC,QAAQ,CAAE,MAFP,CAGHC,KAAK,GAHF,CAIHC,WAAW,GAJR,CAKHC,WAAW,GALR,CAMHC,IAAI,CAAEf,CANH,CAOHgB,IAAI,CAAE,MAPH,CAQHC,OAAO,CAAE,iBAASC,CAAT,CAAkB,IACnBC,CAAAA,CADmB,CAEnBC,CAAG,CAAG5B,CAAC,CAAC6B,SAAF,CAAaH,CAAb,CAFa,CAGvB,GAAkB,CAAd,EAAAE,CAAG,CAACtB,MAAR,CAAqB,CACjBqB,CAAQ,CAAG3B,CAAC,CAAC,iDAAD,CACf,CAFD,IAEO,IAAkB,CAAd,EAAA4B,CAAG,CAACtB,MAAR,CAAqB,CACxBqB,CAAQ,CAAG3B,CAAC,CAAC,0CAAD,CACf,CAED,GAAI4B,CAAG,CAACE,KAAR,CAAe,CACXC,KAAK,CAACH,CAAG,CAACE,KAAL,CAAL,CACA9B,CAAC,CAAC,WAAD,CAAD,CAAegC,GAAf,CAAmB,EAAnB,EACA,MACH,CACD,GAAIC,CAAAA,CAAI,CAAG,8DAA2DL,CAAG,CAACd,GAA/D,CACV,sDADU,CAC4Cc,CAAG,CAACM,QADhD,CAC2D,UADtE,CAEAP,CAAQ,CAACK,GAAT,CAAaC,CAAb,EACA,GAAkB,CAAd,EAAAL,CAAG,CAACtB,MAAR,CAAqB,CACjBN,CAAC,CAAC,wBAAD,CAAD,CAA4BgC,GAA5B,CAAgC,EAAhC,EACAhC,CAAC,CAAC,gCAAD,CAAD,CAAkCmC,KAAlC,EACH,CAHD,IAIK,IAAkB,CAAd,EAAAP,CAAG,CAACtB,MAAR,CAAqB,CACtBN,CAAC,CAAC,iBAAD,CAAD,CAAqBgC,GAArB,CAAyB,EAAzB,EACAhC,CAAC,CAAC,sCAAD,CAAD,CAAwCmC,KAAxC,EACH,CAEJ,CAlCE,CAAP,CAoCD,CA3DA,CA6DV,CAjEK,CAAN","sourcesContent":["define(\r\n    ['jquery'],\r\n    function($) {\r\n\r\n    return {\r\n        init: function(upload) {\r\n            upload = $(upload);\r\n            upload.bind('click', this.uploadFile(upload));\r\n        },\r\n\r\n        uploadFile: function (id) {\r\n            let file_data;\r\n            let drawer = 0;\r\n            if ($('[id^=drawer] #chatfile').prop('files')[0]) {\r\n                file_data = $('[id^=drawer] #chatfile').prop('files')[0];\r\n                drawer = 1;\r\n            } else {\r\n                file_data = $('#page #chatfile').prop('files')[0];\r\n                drawer = 2;\r\n            }\r\n\r\n            if (!file_data) { return; }\r\n            var form_data = new FormData();\r\n            form_data.append('file', file_data);\r\n            var username = $('[data-region=\"view-conversation\"] [data-region=\"header-content\"] strong.text-truncate').text()\r\n            form_data.append('name', username);\r\n            form_data.append('drawer', drawer);\r\n            $.ajax({\r\n                url: M.cfg.wwwroot + '/local/chatfiles/ajax.php?sesskey=' + M.cfg.sesskey,\r\n                dataType: 'text',\r\n                cache: false,\r\n                contentType: false,\r\n                processData: false,\r\n                data: form_data,\r\n                type: 'post',\r\n                success: function(response){\r\n                    var textarea;\r\n                    var obj = $.parseJSON( response );\r\n                    if (obj.drawer == 1) {\r\n                        textarea = $('[id^=drawer] [data-region=\"send-message-txt\"]');\r\n                    } else if (obj.drawer == 2) {\r\n                        textarea = $('#page [data-region=\"send-message-txt\"]');\r\n                    }\r\n\r\n                    if (obj.error) {\r\n                        alert(obj.error);\r\n                        $('#chatfile').val(\"\");\r\n                        return;\r\n                    }\r\n                    var file = '<p class=\"text-success font-italic\"><a class=\"\" href=\"' + obj.url +\r\n                     '\"><i class=\"fa fa-file-o fa-2x pr-2 d-block\"></i>' + obj.filename + '</a></p>';\r\n                    textarea.val(file);\r\n                    if (obj.drawer == 1) {\r\n                        $('[id^=drawer] #chatfile').val(\"\");\r\n                        $('[data-action=\"send-message\"]').click();\r\n                    }\r\n                    else if (obj.drawer == 2) {\r\n                        $('#page #chatfile').val(\"\");\r\n                        $('#page [data-action=\"send-message\"]').click();\r\n                    }\r\n\r\n                }\r\n             });\r\n          },\r\n    };\r\n});\r\n"],"file":"main.min.js"}